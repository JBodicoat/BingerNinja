using UnityEngine;using UnityEngine.EventSystems;using UnityEngine.InputSystem;public enum FoodType{FUGU,SQUID,RICEBALL,KOBEBEEF,SASHIMI,TEMPURA,DANGO,SAKE,NOODLES,NULL}public enum WeaponType{Melee,Ranged}public class PlayerCombat_MarioFernandes : M{WeaponUI_LouieWilliamson q;PlayerAnimation_LouieWilliamson w;public GameObject m_projectile = null;public float m_attackDelay = 1;public float m_timeSinceLastAttack = 0;public float m_meleeAttackRadius = 3;public float m_strenght = 1;public float m_chargedModifier = 1.3f;protected PlayerStealth_JoaoBeijinho m_playerStealthScript;[SerializeField]protected WeaponsTemplate_MarioFernandes[] m_currentWeapon;public int m_weaponsIndex = 0;PlayerHealthHunger_MarioFernandes h;AudioManager_LouieWilliamson e;PlayerController_JamieG r;EffectManager_MarioFernandes t;int y = 0;public void DropWeapon(WeaponType u){if(m_currentWeapon[(int) u]){q.removeWeapon(m_currentWeapon[m_weaponsIndex].IsRanged());Transform o = transform.Find(m_currentWeapon[(int) u].name);o.gameObject.SetActive(true);o.position = transform.position + Vector3.down*0.75f;o.parent = null;m_currentWeapon[(int)u].enabled = false;m_currentWeapon[(int)u] = null;}}public  bool IsHoldingFood(){return false;}public void ResetStrength(){m_strenght = 1;}void Attack(InputAction p, float a = 1){w.TriggerAttackAnim();if (EventSystem.current.currentSelectedGameObject != null && Application.isMobilePlatform){return;}else if(m_currentWeapon[m_weaponsIndex].IsRanged()){Vector3 s;if(Application.isMobilePlatform){s = Camera.main.ScreenToWorldPoint(r.m_aim.ReadValue<Vector2>());s = s - transform.position;}else if(Gamepad.current != null){if(r.m_aim.ReadValue<Vector2>() != Vector2.zero){s = r.m_aim.ReadValue<Vector2>();}else return;}else {s = Camera.main.ScreenToWorldPoint(Mouse.current.position.ReadValue());s = s - transform.position;}s.z = 0;s.Normalize();PlayTrack_Jann.Instance.EM(AudioFiles.Sound_PlayerThrow);GameObject projectile = Instantiate(m_projectile, transform.position, transform.rotation);projectile.GetComponent<Projectile_MarioFernandes>().m_dmg = (int)(m_currentWeapon[m_weaponsIndex].dmg * m_strenght * a);projectile.GetComponent<Projectile_MarioFernandes>().m_distractTime = m_currentWeapon[m_weaponsIndex].m_distractTime;projectile.GetComponent<SpriteRenderer>().sprite = m_currentWeapon[m_weaponsIndex].m_mySprite;projectile.GetComponent<Projectile_MarioFernandes>().m_direction = s;--m_currentWeapon[m_weaponsIndex].m_ammunition;q.setAmmo(m_currentWeapon[m_weaponsIndex].m_ammunition);if(m_currentWeapon[m_weaponsIndex].m_foodType == FoodType.DANGO){GameObject projectile2 = Instantiate(m_projectile, transform.position, transform.rotation);projectile2.GetComponent<Projectile_MarioFernandes>().m_dmg = (int)(m_currentWeapon[m_weaponsIndex].dmg * m_strenght);projectile2.GetComponent<Projectile_MarioFernandes>().m_distractTime = m_currentWeapon[m_weaponsIndex].m_distractTime;projectile2.GetComponent<Projectile_MarioFernandes>().m_speed /= 2;projectile.GetComponent<SpriteRenderer>().sprite = m_currentWeapon[m_weaponsIndex].m_mySprite;}if(m_currentWeapon[m_weaponsIndex].m_ammunition <= 0){q.removeWeapon(m_currentWeapon[m_weaponsIndex].IsRanged());print("D usege");D(m_currentWeapon[m_weaponsIndex].gameObject);m_currentWeapon[m_weaponsIndex] = null;}ColorChanger_Jann.Instance.UpdateColor(projectile.GetComponent<SpriteRenderer>());}else {PlayTrack_Jann.Instance.EM(AudioFiles.Sound_PlayerAttack);float d = Mathf.Infinity;GameObject f = null;GameObject[] g = GameObject.FindGameObjectsWithTag("Enemy");foreach (GameObject h in g){float j = (h.transform.position - this.transform.position).sqrMagnitude;if(j < d){d = j;f = h;}}if(f && d <= m_meleeAttackRadius){f.GetComponentInParent<BaseEnemy_SebastianMol>().RW( WZ.WX , (int)(m_currentWeapon[m_weaponsIndex].dmg * m_strenght * a));}}}public void Eat(){if (m_currentWeapon[m_weaponsIndex] && (!m_currentWeapon[m_weaponsIndex].IsRanged() || m_currentWeapon[m_weaponsIndex].IsRanged() && m_currentWeapon[m_weaponsIndex].m_ammunition >= y)){PlayTrack_Jann.Instance.EM(AudioFiles.Sound_Eating);GetComponent<PlayerHealthHunger_MarioFernandes>().Heal(m_currentWeapon[m_weaponsIndex].m_instaHeal);switch (m_currentWeapon[m_weaponsIndex].m_foodType){case FoodType.FUGU:if (Random.Range(0, 101) >= 50)t.AddEffect(new PoisionDefuff_MarioFernandes(5, m_currentWeapon[m_weaponsIndex].m_poisonDmg));break;case FoodType.SQUID:break;case FoodType.RICEBALL:break;case FoodType.KOBEBEEF:t.AddEffect(new SpeedEffect_MarioFernandes(5, m_currentWeapon[m_weaponsIndex].m_speedModifier));break;case FoodType.SASHIMI:t.AddEffect(new StrengthEffect_MarioFernandes(5, m_currentWeapon[m_weaponsIndex].m_strengthModifier));break;case FoodType.TEMPURA:break;case FoodType.DANGO:break;case FoodType.SAKE:break;case FoodType.NOODLES:t.AddEffect(new StrengthEffect_MarioFernandes(30, m_currentWeapon[m_weaponsIndex].m_strengthModifier));break;default:break;}h.Eat(m_currentWeapon[m_weaponsIndex].m_hungerRestoreAmount);if(m_currentWeapon[m_weaponsIndex].IsRanged()){m_currentWeapon[m_weaponsIndex].m_ammunition -= y;q.setAmmo(m_currentWeapon[m_weaponsIndex].m_ammunition);}if(!m_currentWeapon[m_weaponsIndex].IsRanged() || m_currentWeapon[m_weaponsIndex].m_ammunition <= 0){q.removeWeapon(m_currentWeapon[m_weaponsIndex].IsRanged());D(m_currentWeapon[m_weaponsIndex].gameObject);m_currentWeapon[m_weaponsIndex] = null;}}}public void ChangeWeapon(){if (m_weaponsIndex == 1){m_weaponsIndex = 0;q.SetActiveWeapon(true);}else {m_weaponsIndex = 1;q.SetActiveWeapon(false);}}void Start(){m_currentWeapon = new WeaponsTemplate_MarioFernandes[2];m_playerStealthScript = FOT<PlayerStealth_JoaoBeijinho>();w = GetComponent<PlayerAnimation_LouieWilliamson>();h = FOT<PlayerHealthHunger_MarioFernandes>();e = FOT<AudioManager_LouieWilliamson>();r = GetComponent<PlayerController_JamieG>();q = F("WeaponsUI").GetComponent<WeaponUI_LouieWilliamson>();t = gameObject.GetComponent<EffectManager_MarioFernandes>();}void Update(){if(r.m_dropWeapons.triggered){DropWeapon((WeaponType) m_weaponsIndex);}if(r.m_switchWeapons.triggered){ChangeWeapon();}if(m_timeSinceLastAttack < 0){if (!m_playerStealthScript.B && m_currentWeapon[m_weaponsIndex]){if( r.m_attackTap.triggered){m_timeSinceLastAttack = m_attackDelay;Attack( r.m_attackTap);} else if( r.m_attackSlowTap.triggered){m_timeSinceLastAttack = m_attackDelay;Attack(r.m_attackSlowTap, m_chargedModifier);}}}else m_timeSinceLastAttack -= Time.deltaTime;if(r.m_eat.triggered){Eat();}}void OnTriggerEnter2D(Collider2D j){if(!m_currentWeapon[0] && j.GetComponent<WeaponsTemplate_MarioFernandes>() && !j.GetComponent<WeaponsTemplate_MarioFernandes>().IsRanged()){m_currentWeapon[0] = j.GetComponent<WeaponsTemplate_MarioFernandes>();j.gameObject.SetActive(false);j.transform.parent = transform;q.WeaponChange(m_currentWeapon[0].m_foodType, false, 0);q.SetWeaponsUIAnimation(true);}else if(j.GetComponent<WeaponsTemplate_MarioFernandes>() && j.GetComponent<WeaponsTemplate_MarioFernandes>().IsRanged()){if(!m_currentWeapon[1] ){m_currentWeapon[1] = j.GetComponent<WeaponsTemplate_MarioFernandes>();y = m_currentWeapon[1].m_ammunition;j.gameObject.SetActive(false);j.transform.parent = transform;q.WeaponChange(m_currentWeapon[1].m_foodType, true, m_currentWeapon[1].m_ammunition);q.SetWeaponsUIAnimation(true);}else{if(j.gameObject.activeSelf && m_currentWeapon[1].m_foodType == j.GetComponent<WeaponsTemplate_MarioFernandes>().m_foodType){j.gameObject.SetActive(false);m_currentWeapon[1].m_ammunition += j.GetComponent<WeaponsTemplate_MarioFernandes>().m_ammunition;D(j.gameObject);q.WeaponChange(m_currentWeapon[1].m_foodType, true, m_currentWeapon[1].m_ammunition);q.SetWeaponsUIAnimation(true);}}}}}