using UnityEngine;using UnityEngine.EventSystems;using UnityEngine.InputSystem;public enum FoodType{FUGU,SQUID,RICEBALL,KOBEBEEF,SASHIMI,TEMPURA,DANGO,SAKE,NOODLES,NULL}public enum WeaponType{Melee,Ranged}public class PlayerCombat_MarioFernandes : M{private WeaponUI_LouieWilliamson m_WeaponUI;private PlayerAnimation_LouieWilliamson m_animationScript;public GameObject m_projectile = null;public float m_attackDelay = 1;public float m_timeSinceLastAttack = 0;public float m_meleeAttackRadius = 3;public float m_strenght = 1;public float m_chargedModifier = 1.3f;protected PlayerStealth_JoaoBeijinho m_playerStealthScript;[SerializeField]protected WeaponsTemplate_MarioFernandes[] m_currentWeapon;public int m_weaponsIndex = 0;PlayerHealthHunger_MarioFernandes m_playerHealthHungerScript;private AudioManager_LouieWilliamson m_audioManager;private PlayerController_JamieG Controller;private EffectManager_MarioFernandes m_effectManager;private int m_eatAmmount = 0;public void DropWeapon(WeaponType index){if(m_currentWeapon[(int) index]){m_WeaponUI.removeWeapon(m_currentWeapon[m_weaponsIndex].IsRanged());Transform dropW = transform.Find(m_currentWeapon[(int) index].name);dropW.gameObject.SetActive(true);dropW.position = transform.position + Vector3.down*0.75f;dropW.parent = null;m_currentWeapon[(int)index].enabled = false;m_currentWeapon[(int)index] = null;}}public  bool IsHoldingFood(){return false;}public void ResetStrength(){m_strenght = 1;}void Attack(InputAction cx, float chargedModifier = 1){m_animationScript.TriggerAttackAnim();if (EventSystem.current.currentSelectedGameObject != null && Application.isMobilePlatform){return;}else if(m_currentWeapon[m_weaponsIndex].IsRanged()){Vector3 m_direction;if(Application.isMobilePlatform){m_direction = Camera.main.ScreenToWorldPoint(Controller.m_aim.ReadValue<Vector2>());m_direction = m_direction - transform.position;}else if(Gamepad.current != null){if(Controller.m_aim.ReadValue<Vector2>() != Vector2.zero){m_direction = Controller.m_aim.ReadValue<Vector2>();}else return;}else {m_direction = Camera.main.ScreenToWorldPoint(Mouse.current.position.ReadValue());m_direction = m_direction - transform.position;}m_direction.z = 0;m_direction.Normalize();PlayTrack_Jann.Instance.PlaySound(AudioFiles.Sound_PlayerThrow);GameObject projectile = Instantiate(m_projectile, transform.position, transform.rotation);projectile.GetComponent<Projectile_MarioFernandes>().m_dmg = (int)(m_currentWeapon[m_weaponsIndex].dmg * m_strenght * chargedModifier);projectile.GetComponent<Projectile_MarioFernandes>().m_distractTime = m_currentWeapon[m_weaponsIndex].m_distractTime;projectile.GetComponent<SpriteRenderer>().sprite = m_currentWeapon[m_weaponsIndex].m_mySprite;projectile.GetComponent<Projectile_MarioFernandes>().m_direction = m_direction;--m_currentWeapon[m_weaponsIndex].m_ammunition;m_WeaponUI.setAmmo(m_currentWeapon[m_weaponsIndex].m_ammunition);if(m_currentWeapon[m_weaponsIndex].m_foodType == FoodType.DANGO){GameObject projectile2 = Instantiate(m_projectile, transform.position, transform.rotation);projectile2.GetComponent<Projectile_MarioFernandes>().m_dmg = (int)(m_currentWeapon[m_weaponsIndex].dmg * m_strenght);projectile2.GetComponent<Projectile_MarioFernandes>().m_distractTime = m_currentWeapon[m_weaponsIndex].m_distractTime;projectile2.GetComponent<Projectile_MarioFernandes>().m_speed /= 2;projectile.GetComponent<SpriteRenderer>().sprite = m_currentWeapon[m_weaponsIndex].m_mySprite;}if(m_currentWeapon[m_weaponsIndex].m_ammunition <= 0){m_WeaponUI.removeWeapon(m_currentWeapon[m_weaponsIndex].IsRanged());print("D usege");D(m_currentWeapon[m_weaponsIndex].gameObject);m_currentWeapon[m_weaponsIndex] = null;}ColorChanger_Jann.Instance.UpdateColor(projectile.GetComponent<SpriteRenderer>());}else {PlayTrack_Jann.Instance.PlaySound(AudioFiles.Sound_PlayerAttack);float distanceToClosestsEnemy = Mathf.Infinity;GameObject CloseEnemy = null;GameObject[] allEnemys = GameObject.FindGameObjectsWithTag("Enemy");foreach (GameObject CurrentEnemy in allEnemys){float distanceToEnemy = (CurrentEnemy.transform.position - this.transform.position).sqrMagnitude;if(distanceToEnemy < distanceToClosestsEnemy){distanceToClosestsEnemy = distanceToEnemy;CloseEnemy = CurrentEnemy;}}if(CloseEnemy && distanceToClosestsEnemy <= m_meleeAttackRadius){CloseEnemy.GetComponentInParent<BaseEnemy_SebastianMol>().TakeDamage( m_damageType.MELEE , (int)(m_currentWeapon[m_weaponsIndex].dmg * m_strenght * chargedModifier));}}}public void Eat(){if (m_currentWeapon[m_weaponsIndex] && (!m_currentWeapon[m_weaponsIndex].IsRanged() || m_currentWeapon[m_weaponsIndex].IsRanged() && m_currentWeapon[m_weaponsIndex].m_ammunition >= m_eatAmmount)){PlayTrack_Jann.Instance.PlaySound(AudioFiles.Sound_Eating);GetComponent<PlayerHealthHunger_MarioFernandes>().Heal(m_currentWeapon[m_weaponsIndex].m_instaHeal);switch (m_currentWeapon[m_weaponsIndex].m_foodType){case FoodType.FUGU:if (Random.Range(0, 101) >= 50)m_effectManager.AddEffect(new PoisionDefuff_MarioFernandes(5, m_currentWeapon[m_weaponsIndex].m_poisonDmg));break;case FoodType.SQUID:break;case FoodType.RICEBALL:break;case FoodType.KOBEBEEF:m_effectManager.AddEffect(new SpeedEffect_MarioFernandes(5, m_currentWeapon[m_weaponsIndex].m_speedModifier));break;case FoodType.SASHIMI:m_effectManager.AddEffect(new StrengthEffect_MarioFernandes(5, m_currentWeapon[m_weaponsIndex].m_strengthModifier));break;case FoodType.TEMPURA:break;case FoodType.DANGO:break;case FoodType.SAKE:break;case FoodType.NOODLES:m_effectManager.AddEffect(new StrengthEffect_MarioFernandes(30, m_currentWeapon[m_weaponsIndex].m_strengthModifier));break;default:break;}m_playerHealthHungerScript.Eat(m_currentWeapon[m_weaponsIndex].m_hungerRestoreAmount);if(m_currentWeapon[m_weaponsIndex].IsRanged()){m_currentWeapon[m_weaponsIndex].m_ammunition -= m_eatAmmount;m_WeaponUI.setAmmo(m_currentWeapon[m_weaponsIndex].m_ammunition);}if(!m_currentWeapon[m_weaponsIndex].IsRanged() || m_currentWeapon[m_weaponsIndex].m_ammunition <= 0){m_WeaponUI.removeWeapon(m_currentWeapon[m_weaponsIndex].IsRanged());print("D Eating");D(m_currentWeapon[m_weaponsIndex].gameObject);m_currentWeapon[m_weaponsIndex] = null;}}}public void ChangeWeapon(){if (m_weaponsIndex == 1){m_weaponsIndex = 0;m_WeaponUI.SetActiveWeapon(true);}else {m_weaponsIndex = 1;m_WeaponUI.SetActiveWeapon(false);}}void Start(){m_currentWeapon = new WeaponsTemplate_MarioFernandes[2];m_playerStealthScript = FOT<PlayerStealth_JoaoBeijinho>();m_animationScript = GetComponent<PlayerAnimation_LouieWilliamson>();m_playerHealthHungerScript = FOT<PlayerHealthHunger_MarioFernandes>();m_audioManager = FOT<AudioManager_LouieWilliamson>();Controller = GetComponent<PlayerController_JamieG>();m_WeaponUI = F("WeaponsUI").GetComponent<WeaponUI_LouieWilliamson>();m_effectManager = gameObject.GetComponent<EffectManager_MarioFernandes>();}void Update(){if(Controller.m_dropWeapons.triggered){DropWeapon((WeaponType) m_weaponsIndex);}if(Controller.m_switchWeapons.triggered){ChangeWeapon();}if(m_timeSinceLastAttack < 0){if (!m_playerStealthScript.m_crouched && m_currentWeapon[m_weaponsIndex]){if( Controller.m_attackTap.triggered){m_timeSinceLastAttack = m_attackDelay;Attack( Controller.m_attackTap);} else if( Controller.m_attackSlowTap.triggered){m_timeSinceLastAttack = m_attackDelay;Attack(Controller.m_attackSlowTap, m_chargedModifier);}}}else m_timeSinceLastAttack -= Time.deltaTime;if(Controller.m_eat.triggered){Eat();}}private void OnTriggerEnter2D(Collider2D collision){if(!m_currentWeapon[0] && collision.GetComponent<WeaponsTemplate_MarioFernandes>() && !collision.GetComponent<WeaponsTemplate_MarioFernandes>().IsRanged()){m_currentWeapon[0] = collision.GetComponent<WeaponsTemplate_MarioFernandes>();collision.gameObject.SetActive(false);collision.transform.parent = transform;m_WeaponUI.WeaponChange(m_currentWeapon[0].m_foodType, false, 0);m_WeaponUI.SetWeaponsUIAnimation(true);}else if(collision.GetComponent<WeaponsTemplate_MarioFernandes>() && collision.GetComponent<WeaponsTemplate_MarioFernandes>().IsRanged()){if(!m_currentWeapon[1] ){m_currentWeapon[1] = collision.GetComponent<WeaponsTemplate_MarioFernandes>();m_eatAmmount = m_currentWeapon[1].m_ammunition;collision.gameObject.SetActive(false);collision.transform.parent = transform;m_WeaponUI.WeaponChange(m_currentWeapon[1].m_foodType, true, m_currentWeapon[1].m_ammunition);m_WeaponUI.SetWeaponsUIAnimation(true);}else{if(collision.gameObject.activeSelf && m_currentWeapon[1].m_foodType == collision.GetComponent<WeaponsTemplate_MarioFernandes>().m_foodType){collision.gameObject.SetActive(false);m_currentWeapon[1].m_ammunition += collision.GetComponent<WeaponsTemplate_MarioFernandes>().m_ammunition;D(collision.gameObject);m_WeaponUI.WeaponChange(m_currentWeapon[1].m_foodType, true, m_currentWeapon[1].m_ammunition);m_WeaponUI.SetWeaponsUIAnimation(true);}}}}}