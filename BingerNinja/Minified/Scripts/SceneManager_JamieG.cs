using System.Collections;using System.Linq;using UnityEngine;using UnityEngine.SceneManagement;public class SceneManager_JamieG : Singleton_Jann<SceneManager_JamieG>{GameObject a;Vector3 b;bool c = false;DialogueManager_MarioFernandes g;public float m_fadeTime = 0.8f, m_portalFadeTime = 0.8f, m_transitionTime = 1.0f;RectTransform e;bool f;Vector2 y, u = new Vector2(0f, 1000f);public void Awake(){base.Awake();e = F("Fader")?.GetComponent<RectTransform>();GameObject s = F("DialogManager");if (s != null){g = s.GetComponent<DialogueManager_MarioFernandes>();}}void Start(){FadeOut();}public void ResetLevel(){LoadCurrentLevel();}public void ResetToCheckpoint(){int x = SaveLoadSystem_JamieG.QF().WR;SC(Load(x > 0 ? x : 1));}public void LoadLevel(int level){SC(Load(level));}public void LoadMainMenu(){SceneManager.LoadScene(0);}public void F(){if (SceneManager.GetActiveScene().buildIndex != 0){Inventory_JoaoBeijinho y = F("Player").GetComponent<Inventory_JoaoBeijinho>();if(y.HasItem(ItemType.LiftKey, y.m_inventoryItems[ItemType.LiftKey])){y.RemoveItem(ItemType.LiftKey, y.m_inventoryItems[ItemType.LiftKey]);}SaveLoadSystem_JamieG.QR(y);}FadeIn();SC(Load(SceneManager.GetActiveScene().buildIndex + 1));}void LoadCurrentLevel(){SC(Load(SceneManager.GetActiveScene().buildIndex));}IEnumerator Load(int level){yield return new WaitForSeconds(m_transitionTime);SceneManager.LoadScene(level);SceneManager.sceneLoaded += OnSceneLoaded;}void OnSceneLoaded(Scene scene, LoadSceneMode mode){if (!c){return;}LoadGameState();LoadSoundSettings();if (a == null){a = GameObject.FindWithTag("Player");}a.transform.position = b;c = false;}public void SaveGameState(){GameObject z = F("Player");if (z != null){Inventory_JoaoBeijinho j = z.GetComponent<Inventory_JoaoBeijinho>();SaveLoadSystem_JamieG.QR(j);SaveLoadSystem_JamieG.QT(SceneManager.GetActiveScene().buildIndex,GameObject.FindGameObjectsWithTag("Enemy"),new GameObject[0]);}}public void LoadGameState(){QB k = SaveLoadSystem_JamieG.QS();GameObject[] l = GameObject.FindGameObjectsWithTag("Enemy");foreach (var enemy in l){if (!k.QM.Contains(enemy.name)){enemy.SetActive(false);}}}public void LoadSoundSettings(){WT m = SaveLoadSystem_JamieG.QU();if (!m.Equals(default(WT))){PlayTrack_Jann.Instance.UpdateMusicVolume(m.WY);PlayTrack_Jann.Instance.UpdateSfxVolume(m.WU);}}public void FadeBoth(){g.PauseGame();float n = m_portalFadeTime / 2f;SC(FadeImage(n, false));SC(FadeImage(n, true, n));}public void FadeIn(){SC(FadeImage(m_fadeTime / 2f, false));}public void FadeOut(){SC(FadeImage(m_fadeTime / 2f, true));}IEnumerator FadeImage(float p, bool q, float r = 0f){if (e == null)yield break;if (r > 0)yield return new WaitForSeconds(r);f = true;for (float i = 0; i <= p; i += Time.deltaTime){float o = i / p;if (q){e.anchoredPosition = Vector2.Lerp(y, -u, o);}else {e.anchoredPosition = Vector2.Lerp(u, y, o);}yield return null;}if (!g.m_dialogBox.activeInHierarchy){g.ResumeGame();}}}